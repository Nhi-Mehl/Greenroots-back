BEGIN; 

DROP TABLE IF EXISTS "project", "project_tree", "species", "user", "order", "order_line";

CREATE TABLE "project" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "name" VARCHAR NOT NULL,
  "description" TEXT NOT NULL,
  "picture" INTEGER NOT NULL,
  "status" VARCHAR NOT NULL,
  "city" VARCHAR NOT NULL,
  "country" VARCHAR NOT NULL,
  "continent" VARCHAR NOT NULL,
  "created_at" TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ
);


CREATE TABLE "species" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "name" VARCHAR NOT NULL,
  "scientific_name" VARCHAR NOT NULL,
  "description" TEXT NOT NULL,
  "price" DECIMAL NOT NULL,
  "picture" VARCHAR NOT NULL,
  "co2_compensation" DECIMAL NOT NULL,
  "created_at" TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ
);

CREATE TABLE "project_tree" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "basic_quantity" INTEGER,
  "current_quantity" INTEGER,
  "project_id" INTEGER NOT NULL REFERENCES "project"("id") ON DELETE CASCADE,
  "species_id" INTEGER NOT NULL REFERENCES "species"("id") ON DELETE CASCADE,
  "created_at" TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ
);



CREATE TABLE "user" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "first_name" VARCHAR NOT NULL,
  "last_name" VARCHAR NOT NULL,
  "role" VARCHAR NOT NULL DEFAULT 'user',
  "address" VARCHAR NOT NULL,
  "zip_code" VARCHAR NOT NULL,
  "city" VARCHAR NOT NULL,
  "country" VARCHAR NOT NULL,
  "phone_number" VARCHAR,
  "email" VARCHAR NOT NULL,
  "password" VARCHAR NOT NULL,
  "created_at" TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ
);

CREATE TABLE "order" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "amount" DECIMAL,
  "date" TIMESTAMPTZ,
  "user_id" INTEGER NOT NULL REFERENCES "user"("id") ON DELETE CASCADE,
  "created_at" TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ
);

CREATE TABLE "order_line" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "quantity" INTEGER NOT NULL,
  "amount" DECIMAL,
  "project_tree_id" INTEGER NOT NULL REFERENCES "project_tree"("id") ON DELETE CASCADE,
  "order_id" INTEGER NOT NULL REFERENCES "order"("id") ON DELETE CASCADE,
  "created_at" TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ
);


COMMIT;